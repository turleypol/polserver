use os;
use uo;
use guilds;
include "testutil";

var testrun:=CInt(GetEnvironmentVariable("POLCORE_TEST_RUN"));

program test_guild()
  return 1;
endprogram

exported function load_save_guild()
  if (testrun == 1)
    var chr1:=createAccountWithChar("restart_test_guild1", "pass");
    var chr2:=createAccountWithChar("restart_test_guild2", "pass");
    var guild1:=CreateGuild();
    var guild2:=CreateGuild();
    var guild3:=CreateGuild();
    if (!chr1 || !chr2 || !guild1 || !guild2 || !guild3)
      return ret_error($"create failed {chr1} {chr2} {guild1} {guild2} {guild3}");
    endif
    guild1.setprop("name","test");
    guild2.setprop("name","ally");
    guild3.setprop("name","enemy");
    guild1.addallyguild(guild2);
    guild1.addenemyguild(guild3);
    guild1.addmember(chr1);
    guild1.addmember(chr2);
  else
    print(listguilds());
  endif
  return 1;
endfunction
