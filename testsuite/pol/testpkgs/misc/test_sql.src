use uo;
use os;
use sql;

include "testutil";

program testsql()
  return 1;
endprogram

exported function sqlconnect()
  var conn:=mysql_connect("localhost","root","root");
  if (!conn)
    return ret_error($"failed to connect: {conn}");
  endif
  var db:=mysql_select_db(conn,"poltest");
  if (!db)
    mysql_close(conn);
    return ret_error($"failed to select db: {db}");
  endif
  mysql_close(conn);
  return 1;
endfunction

exported function sqlquery()
  var conn:=mysql_connect("localhost","root","root");
  if (!conn)
    return ret_error($"failed to connect: {conn}");
  endif
  var db:=mysql_select_db(conn,"poltest");
  if (!db)
    mysql_close(conn);
    return ret_error($"failed to select db: {db}");
  endif

  var query:=mysql_query("CREATE TABLE IF NOT EXISTS db_test (`key` int(11) NOT NULL, `val` varchar(128) NOT NULL, PRIMARY KEY (`int`))");
  print(query);
  query:=mysql_query("INSERT INTO db_test (key, val) VALUES (1,'one')");
  print(query);
  query:=mysql_query("INSERT INTO db_test (key, val) VALUES (2,'two')");
  print(query);
  query:=mysql_query("SELECT val FROM db_test");
  For i:=1 To (mysql_num_rows(res))
    print( mysql_fetch_row(res));
  EndFor
  mysql_close(conn);
  return 1;
endfunction
